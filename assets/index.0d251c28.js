import{a as _e,r as c,w as pe,m as fe,a0 as ve,l as ge,al as u,o as r,Q as x,R as t,X as s,b as n,V as v,W as S,c as d,ab as g,F as b,S as H,Y as K,a5 as be,U as he,u as h,H as T}from"./vue.562ccee8.js";import{r as B,X as Ve,V as ye,E as ke}from"./index.ab2bd5b7.js";import{_ as Ce}from"./_plugin-vue_export-helper.c27b6911.js";function we(k){return B({url:"/api/system/role_menu_button_permission/get_role_premission/",method:"get",params:k})}function xe(k,R){return B({url:`/api/system/role_menu_button_permission/${k}/set_role_premission/`,method:"put",data:R})}function De(){return B({url:"/api/system/role_menu_button_permission/data_scope/",method:"get"})}function Pe(){return B({url:"/api/system/role_menu_button_permission/role_to_dept_all/",method:"get"})}const Ue={class:"permission-com"},Ne={class:"pc-collapse-main"},Se={class:"pccm-item"},Be={class:"btn-item"},Re=["onClick"],Me={key:0,class:"pccm-item"},Ee={class:"columns-list"},Te={class:"columns-head"},Xe={class:"width-txt"},qe={class:"pc-dialog"},ze=_e({__name:"index",props:{roleId:{type:Number,default:-1},roleName:{type:String,default:""},drawerVisible:{type:Boolean,default:!1}},emits:["update:drawerVisible"],setup(k,{emit:R}){const D=k,L=R,M=c(!1);pe(()=>D.drawerVisible,l=>{M.value=l,$(),j()});const Q=()=>{L("update:drawerVisible",!1)},W={children:"children",label:"name",value:"id"};let P=c([]);c([]);let X=c({}),q=c(-1),V=c(!1),U=c([]);const Y=fe(()=>function(l){const e=U.value.find(i=>i.value===l);return(e==null?void 0:e.label)||""});let z=c([]),m=c(),y=c([]);const $=async()=>{const l=await we({role:D.roleId});P.value=l.data},j=async()=>{try{const l=await De();(l==null?void 0:l.code)===2e3&&(U.value=l.data)}catch{return}},G=(l,e)=>{X.value=l,q.value=e,V.value=!0},J=(l,e,i)=>{for(const p of e.columns)p[i]=l},O=async l=>{if(l===4){const e=await Pe(),i=Ve.toArrayTree(e.data,{parentKey:"parent",strict:!1});z.value=i}},Z=()=>{if(m.value!==0&&!m.value){ye("请选择");return}for(const l of P.value)for(const e of l.menus)if(e.id===X.value.id){for(const i of e.btns)if(i.id===q.value){const p=U.value.find(C=>C.value===m.value);i.data_range=(p==null?void 0:p.value)||0,i.data_range===4&&(i.dept=y.value)}}E()},E=()=>{V.value=!1,y.value=[],m.value=null},ee=()=>{xe(D.roleId,P.value).then(l=>{ke({message:l.msg,type:"success"})})},F=ve({header:[{value:"is_create",label:"新增可见"},{value:"is_update",label:"编辑可见"},{value:"is_query",label:"列表可见"}]});return ge(()=>{}),(l,e)=>{const i=u("el-tag"),p=u("el-col"),C=u("el-button"),le=u("el-row"),N=u("el-checkbox"),te=u("Setting"),ae=u("el-icon"),I=u("el-tab-pane"),A=u("el-tabs"),oe=u("el-option"),se=u("el-select"),ne=u("el-tree-select"),re=u("el-dialog"),ue=u("el-drawer");return r(),x(ue,{modelValue:M.value,"onUpdate:modelValue":e[3]||(e[3]=o=>M.value=o),title:"权限配置",direction:"rtl",size:"60%","close-on-click-modal":!1,"before-close":Q,"destroy-on-close":!0},{header:t(()=>[s(le,null,{default:t(()=>[s(p,{span:4},{default:t(()=>[n("div",null,[e[4]||(e[4]=v("当前授权角色： ")),s(i,null,{default:t(()=>[v(S(D.roleName),1)]),_:1})])]),_:1}),s(p,{span:6},{default:t(()=>[n("div",null,[s(C,{size:"small",type:"primary",class:"pc-save-btn",onClick:ee},{default:t(()=>e[5]||(e[5]=[v("保存菜单授权 ")])),_:1})])]),_:1})]),_:1})]),default:t(()=>[n("div",Ue,[s(A,null,{default:t(()=>[(r(!0),d(b,null,g(h(P),(o,ie)=>(r(),x(I,{key:ie,label:o.name},{default:t(()=>[s(A,{"tab-position":"left"},{default:t(()=>[(r(!0),d(b,null,g(o.menus,(_,de)=>(r(),x(I,{key:de,label:_.name},{default:t(()=>[s(N,{modelValue:_.isCheck,"onUpdate:modelValue":a=>_.isCheck=a},{default:t(()=>e[6]||(e[6]=[v("页面显示权限")])),_:2},1032,["modelValue","onUpdate:modelValue"]),n("div",Ne,[n("div",Se,[e[7]||(e[7]=n("div",{class:"menu-form-alert"}," 配置操作功能接口权限,配置数据权限点击小齿轮 ",-1)),(r(!0),d(b,null,g(_.btns,(a,w)=>(r(),x(N,{key:w,modelValue:a.isCheck,"onUpdate:modelValue":f=>a.isCheck=f,label:a.value},{default:t(()=>[n("div",Be,[v(S(a.data_range!==null?`${a.name}(${Y.value(a.data_range)})`:a.name)+" ",1),H(n("span",{onClick:be(f=>G(_,a.id),["stop","prevent"])},[s(ae,null,{default:t(()=>[s(te)]),_:1})],8,Re),[[K,a.isCheck]])])]),_:2},1032,["modelValue","onUpdate:modelValue","label"]))),128))]),_.columns&&_.columns.length>0?(r(),d("div",Me,[e[9]||(e[9]=n("div",{class:"menu-form-alert"}," 配置数据列字段权限 ",-1)),n("ul",Ee,[n("li",Te,[e[8]||(e[8]=n("div",{class:"width-txt"},[n("span",null,"字段")],-1)),(r(!0),d(b,null,g(F.header,(a,w)=>(r(),d("div",{key:w,class:"width-check"},[s(N,{label:a.value,onChange:f=>J(f,_,a.value)},{default:t(()=>[n("span",null,S(a.label),1)]),_:2},1032,["label","onChange"])]))),128))]),(r(!0),d(b,null,g(_.columns,(a,w)=>(r(),d("li",{key:w,class:"columns-item"},[n("div",Xe,S(a.title),1),(r(!0),d(b,null,g(F.header,(f,ce)=>(r(),d("div",{key:ce,class:"width-check"},[s(N,{modelValue:a[f.value],"onUpdate:modelValue":me=>a[f.value]=me,class:"ci-checkout"},null,8,["modelValue","onUpdate:modelValue"])]))),128))]))),128))])])):he("",!0)])]),_:2},1032,["label"]))),128))]),_:2},1024)]),_:2},1032,["label"]))),128))]),_:1}),s(re,{modelValue:h(V),"onUpdate:modelValue":e[2]||(e[2]=o=>T(V)?V.value=o:V=o),title:"数据权限配置",width:"400px","close-on-click-modal":!1,"before-close":E},{footer:t(()=>[n("div",null,[s(C,{type:"primary",onClick:Z},{default:t(()=>e[10]||(e[10]=[v(" 确定")])),_:1}),s(C,{onClick:E},{default:t(()=>e[11]||(e[11]=[v(" 取消")])),_:1})])]),default:t(()=>[n("div",qe,[s(se,{modelValue:h(m),"onUpdate:modelValue":e[0]||(e[0]=o=>T(m)?m.value=o:m=o),onChange:O,class:"dialog-select",placeholder:"请选择"},{default:t(()=>[(r(!0),d(b,null,g(h(U),o=>(r(),x(oe,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),H(s(ne,{"node-key":"id",modelValue:h(y),"onUpdate:modelValue":e[1]||(e[1]=o=>T(y)?y.value=o:y=o),props:W,data:h(z),multiple:"","check-strictly":"","render-after-expand":!1,"show-checkbox":"",class:"dialog-tree"},null,8,["modelValue","data"]),[[K,h(m)===4]])])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])}}});const He=Ce(ze,[["__scopeId","data-v-4053e473"]]);export{He as default};
