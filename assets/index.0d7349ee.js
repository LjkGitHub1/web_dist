import{R as _e,d as Z,r as J,J as ve,O as ge}from"./index.ab2bd5b7.js";import{createCrudOptions as ye}from"./crud.1976b560.js";import{a as E,r as f,w as ee,l as G,n as N,o as d,c as L,b as D,W as B,Q as g,af as be,ag as we,T as xe,a0 as Q,al as n,S as he,Y as Ce,X as o,R as i,F as q,ab as X,ad as ke,V as O,u as w,U as A,M as Se,O as Ve}from"./vue.562ccee8.js";import{_ as te}from"./_plugin-vue_export-helper.c27b6911.js";const R={IMAGE:8,VIDEO:4,AUDIO:2,OTHER:1,ALL:15},Le=["title"],Re={class:"file-name"},De=E({__name:"fileItem",props:{fileData:{type:Object,required:!0}},setup(z,{expose:C}){const y=z,k=E({template:"<el-icon><Files /></el-icon>"}),x=[{tag:"img",attr:{src:y.fileData.url,draggable:!1}},{tag:"video",attr:{src:y.fileData.url,controls:!1,autoplay:!0,muted:!0,loop:!0}},{tag:"audio",attr:{src:y.fileData.url,controls:!0,autoplay:!1,muted:!1,loop:!1,volume:0}},{tag:k,attr:{style:{fontSize:"2rem"}}}],t=f(null),u=f(null);return ee(y.fileData,c=>u.value=c,{immediate:!0,deep:!0}),C({}),G(async()=>{var c,p;await N(),(c=t.value)==null||c.addEventListener("mouseenter",()=>{var m,a;(a=(m=t.value)==null?void 0:m.querySelector(".file-name"))==null||a.classList.add("show")}),(p=t.value)==null||p.addEventListener("mouseleave",()=>{var m,a;(a=(m=t.value)==null?void 0:m.querySelector(".file-name"))==null||a.classList.remove("show")})}),(c,p)=>(d(),L("div",{ref_key:"itemRef",ref:t,class:"file-item",title:u.value.name},[D("div",Re,B(u.value.name),1),(d(),g(xe(x[u.value.file_type].tag),be(we(x[u.value.file_type].attr)),null,16))],8,Le))}});const Ae=te(De,[["__scopeId","data-v-5d50041c"]]),Oe={style:{padding:"4px"}},ze=["data-id"],Ie={class:"listPaginator"},Y="/api/system/file/",Fe=E({__name:"index",props:{modelValue:{},tabsType:{type:Object,default:""},itemSize:{type:Number,default:100},tabsShow:{type:Number,default:R.ALL},multiple:{type:Boolean,default:!1},selectable:{type:Boolean,default:!0},valueKey:{type:String,default:"id"}},emits:["update:modelValue"],setup(z,{expose:C,emit:y}){const k=["图片","视频","音频","文件"],x=["image/*","video/*","audio/*",""],t=z,u=f(!1),c=f(0),p={GetList:s=>J({url:Y,method:"get",params:s}),GetAll:()=>J({url:Y+"get_all/"})},m=Q({name:""}),a=Q({page:1,limit:10,total:0}),h=f([]),I=f([]),b=async()=>{let s=await p.GetList({page:a.page,limit:a.limit,file_type:c.value,...m});h.value=s.data,a.total=s.total,a.page=s.page,a.limit=s.limit,$()},S=async()=>{let s=await p.GetAll();I.value=s.data},le=s=>{a.page=1,b()},ae=(s,e)=>{a.page=s,a.limit=e,b()},U=f(),se=async s=>{var F;if(!t.selectable)return;let e=s.target,_=0;for(;!e.dataset.id;)e=e.parentElement;let v=e.dataset.id;if(t.multiple)e.classList.contains("active")?(e.classList.remove("active"),_=-1):(e.classList.add("active"),_=1),r.value?_===1?r.value.push(v):r.value.splice(r.value.indexOf(v),1):r.value=[v],r.value=Array.from(new Set(r.value)).sort();else{for(let V of(F=U.value)==null?void 0:F.children)V.classList.remove("active");e.classList.add("active"),r.value=v}K(r.value)},$=async()=>{var s,e;if(t.selectable){await N();for(let _ of((s=U.value)==null?void 0:s.children)||[]){_.classList.remove("active");let v=_.dataset.id;t.multiple?(e=r.value)!=null&&e.includes(v)&&_.classList.add("active"):v===r.value&&_.classList.add("active")}}},M=f(),j=()=>{m.name="",a.page=1,a.limit=10,a.total=0,h.value=[],r.value=null},r=f(),oe=y;ee(()=>t.modelValue,s=>{r.value=s},{immediate:!0});const{ui:ne}=_e(),H=ne.formItem.injectFormItemContext(),K=s=>{oe("update:modelValue",s),H.onChange(),H.onBlur()};return C({data:r,onDataChange:K,selectVisiable:u,clear:j}),G(()=>S()),(s,e)=>{const _=n("el-option"),v=n("el-select"),F=n("el-divider"),V=n("el-tab-pane"),ie=n("el-tabs"),ue=n("el-input"),re=n("el-tag"),W=n("el-span"),T=n("el-button"),de=n("el-upload"),ce=n("el-row"),pe=n("el-empty"),me=n("el-pagination"),fe=n("el-dialog");return d(),L(q,null,[he(o(v,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value=l),"suffix-icon":"arrow-down",clearable:"",multiple:t.multiple,placeholder:"请选择文件",onClick:e[1]||(e[1]=l=>u.value=!0),onClear:$,onRemoveTag:$},{default:i(()=>[(d(!0),L(q,null,X(I.value,(l,P)=>(d(),g(_,{key:P,value:l[t.valueKey],label:l.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","multiple"]),[[Ce,t.selectable]]),o(fe,{modelValue:u.value,"onUpdate:modelValue":e[9]||(e[9]=l=>u.value=l),draggable:!1,width:"50%","align-center":!1,onOpen:e[10]||(e[10]=l=>{h.value.length===0&&b()}),onClosed:e[11]||(e[11]=l=>{t.selectable||j()})},ke({header:i(()=>[e[12]||(e[12]=D("span",{class:"el-dialog__title"},"文件选择",-1)),o(F,{style:{margin:"0"}})]),default:i(()=>[D("div",Oe,[o(ie,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=l=>c.value=l),type:t.tabsType,stretch:!0,onTabChange:le},{default:i(()=>[t.tabsShow&w(R).IMAGE?(d(),g(V,{key:0,name:0,label:"图片"})):A("",!0),t.tabsShow&w(R).VIDEO?(d(),g(V,{key:1,name:1,label:"视频"})):A("",!0),t.tabsShow&w(R).AUDIO?(d(),g(V,{key:2,name:2,label:"音频"})):A("",!0),t.tabsShow&w(R).OTHER?(d(),g(V,{key:3,name:3,label:"其他"})):A("",!0)]),_:1},8,["modelValue","type"]),o(ce,{justify:"space-between",class:"headerBar"},{default:i(()=>[o(W,{span:16},{default:i(()=>[o(ue,{modelValue:m.name,"onUpdate:modelValue":e[3]||(e[3]=l=>m.name=l),placeholder:`请输入${k[c.value]}名`,"prefix-icon":"search",clearable:"",onChange:b},null,8,["modelValue","placeholder"]),D("div",null,[t.multiple?(d(),g(re,{key:0,type:"primary",effect:"light"},{default:i(()=>{var l;return[O(" 一共选中 "+B(((l=r.value)==null?void 0:l.length)||0)+" 个文件 ",1)]}),_:1})):A("",!0)])]),_:1}),o(W,{span:8},{default:i(()=>[o(T,{type:"default",circle:"",icon:"refresh",onClick:b}),o(de,{ref_key:"uploadRef",ref:M,action:w(Z)()+"api/system/file/",multiple:!1,data:{upload_method:1},drag:!1,"show-file-list":!1,accept:x[c.value],"on-success":()=>{b(),S(),M.value.clearFiles()}},{default:i(()=>[o(T,{type:"primary",icon:"plus"},{default:i(()=>[O("上传"+B(k[c.value]),1)]),_:1})]),_:1},8,["action","accept","on-success"])]),_:1})]),_:1}),h.value.length?(d(),L("div",{key:1,ref_key:"listContainerRef",ref:U,class:"listContainer"},[(d(!0),L(q,null,X(h.value,l=>(d(),L("div",{style:Se({width:(t.itemSize||100)+"px"}),key:l.id,onClick:e[4]||(e[4]=P=>se(P)),"data-id":l[t.valueKey]},[o(Ae,{fileData:l},null,8,["fileData"])],12,ze))),128))],512)):(d(),g(pe,{key:0,description:"无内容，请上传",style:{width:"100%",height:"calc(50vh)","margin-top":"24px",padding:"4px"}})),D("div",Ie,[o(me,{background:"",size:"small",layout:"total, sizes, prev, pager, next",total:a.total,"page-size":a.limit,"onUpdate:pageSize":e[5]||(e[5]=l=>a.limit=l),"page-sizes":[10,20,30,40,50],"current-page":a.page,"onUpdate:currentPage":e[6]||(e[6]=l=>a.page=l),"hide-on-single-page":!1,onChange:ae},null,8,["total","page-size","current-page"])])])]),_:2},[t.selectable?{name:"footer",fn:i(()=>[o(T,{type:"default",onClick:e[7]||(e[7]=l=>u.value=!1)},{default:i(()=>e[13]||(e[13]=[O("取消")])),_:1}),o(T,{type:"primary",onClick:e[8]||(e[8]=l=>u.value=!1)},{default:i(()=>e[14]||(e[14]=[O("确定")])),_:1})]),key:"0"}:void 0]),1032,["modelValue"])],64)}}});const Te=te(Fe,[["__scopeId","data-v-78273743"]]),Pe=E({__name:"index",setup(z){const C=f(null),y=p=>p<1024?p+"b":p<1024*1024?(p/1024).toFixed(2)+"Kb":(p/(1024*1024)).toFixed(2)+"Mb",k=async()=>{C.value.selectVisiable=!0,await N()},x=f(),t=f(),{crudExpose:u}=ve({crudRef:x,crudBinding:t}),{crudOptions:c}=ye({crudExpose:u,context:{openAddHandle:k}});return ge({crudExpose:u,crudOptions:c}),G(()=>{u.doRefresh()}),(p,m)=>{const a=n("el-button"),h=n("el-upload"),I=n("fs-crud"),b=n("fs-page");return d(),g(b,null,{default:i(()=>[o(I,Ve({ref_key:"crudRef",ref:x},t.value),{"actionbar-left":i(S=>[o(h,{action:w(Z)()+"api/system/file/",multiple:!1,"on-success":()=>w(u).doRefresh(),drag:!1,"show-file-list":!1},{default:i(()=>[o(a,{type:"primary",icon:"plus"},{default:i(()=>m[0]||(m[0]=[O("上传")])),_:1})]),_:1},8,["action","on-success"])]),cell_size:i(S=>[D("span",null,B(S.row.size?y(S.row.size):"0b"),1)]),_:1},16),o(Te,{ref_key:"fileSelectorRef",ref:C,tabsShow:w(R).ALL,itemSize:120,multiple:!1,selectable:!1},null,8,["tabsShow"])]),_:1})}}});export{Pe as default};
