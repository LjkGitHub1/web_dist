import{s as ge,D as ee,U as Ve,G as he}from"./api.f3a6db2e.js";import{d as q}from"./dictionary.100483c1.js";import{d as le,S as xe,x as Ue,y as we,z as Ce,A as R,s as Oe}from"./index.ab2bd5b7.js";import{a as Re,a0 as te,r as b,G as ze,w as Se,al as i,o as d,c as k,X as a,R as o,V as y,F as j,ab as N,Q as c,W as C,b as v,u as s,H as oe,U as Ie,n as Te}from"./vue.562ccee8.js";import{_ as je}from"./_plugin-vue_export-helper.c27b6911.js";const Ne={key:1},Le={slot:"prepend"},We={style:{padding:"0px 5px"}},De={key:1},$e=["src"],Be=["src"],qe={style:{"text-align":"right",margin:"0"}},Ee=Re({__name:"formContent",props:["options","editableTabsItem"],setup(L){const E=L;let r=te({}),g=b([]);b([]);let U=b(!1);const ae=te({title:[{required:!0,message:"必须填写"}],key:[{required:!0,message:"必须填写"}],value:[{required:!0,message:"必须填写"}]}),J=b();let A=b(le()+"api/system/file/"),F=b({Authorization:"JWT "+xe.get("token")}),W=b(""),D=b(!1);b(null);const ne=()=>{he({parent:E.options.id,limit:999}).then(n=>{let t=n.data;g.value=t;const p={};for(const _ of t){const u=_.key;_.value?p[u]=_.value:[5,12,14].indexOf(_.form_item_type)!==-1?p[u]=[]:p[u]=_.value,_.form_item_type_label==="array"&&(console.log("test"),Te(()=>{const V=b();console.log(V)}))}r=Object.assign(r,p)})},se=n=>{const t=Object.keys(r),p=Object.values(r);for(const _ in g.value){const u=g.value[_];u.form_item_type_label==="array"&&(u.id,""+u.key),t.map((O,w)=>{if(O===u.key&&(u.form_item_type_label!=="array"&&(u.value=p[w]),["img","imgs"].indexOf(u.form_item_type_label)>-1)){for(const S of u.rule)if(S.required&&u.value===null){R(u.title+"不能为空");return}}})}n&&n.validate(_=>{if(_)ge(g.value).then(u=>{Oe("保存成功"),z&&z()});else return console.log("error submit!!"),!1})},re=n=>{},de=(n,t,p)=>{console.log(n,t),n.id&&ee(n.id).then(_=>{})},G=n=>{W=n.url,D.value=!0},ue=n=>{if(typeof n!="string")return;const t=n.toLowerCase();return t.endsWith(".png")||t.endsWith(".jpeg")||t.endsWith(".jpg")||t.endsWith(".png")||t.endsWith(".bmp")},H=(n,t,p,_)=>{const{code:u,msg:V}=n;if(u===2e3){const{url:O}=n.data,{name:w}=t;if(!ue(w))R("只允许上传图片");else{const I=r[_];(!I||I==="")&&(r[_]=[]);const $={name:w,url:le()+O};r[_].push($)}}else R("上传失败,"+JSON.stringify(V))},M=()=>{R("上传失败")},P=()=>{R("超过文件上传数量")},Q=(n,t,p)=>{var _=0;r[p].map((u,V)=>{u.uid===n.uid&&(_=V)}),r[p].splice(_,1)},ie=n=>{ee(n.id).then(t=>{})},pe=n=>{g.value[n].edit=!0,g.value[n].new_key=g.value[n].key},z=ze("refreshView"),_e=n=>{n.key=JSON.parse(JSON.stringify(n.new_key)),Ve(n).then(t=>{z&&z()})};return Se(E.options,n=>{n&&n.id&&ne()},{immediate:!0}),(n,t)=>{const p=i("el-col"),_=i("el-row"),u=i("el-input"),V=i("el-input-number"),O=i("el-date-picker"),w=i("el-option"),S=i("el-select"),I=i("el-checkbox"),$=i("el-checkbox-group"),fe=i("el-radio"),ce=i("el-radio-group"),X=i("el-switch"),Y=i("el-upload"),Z=i("el-dialog"),me=i("table-selector"),B=i("vxe-input"),T=i("vxe-column"),h=i("el-button"),ye=i("el-popover"),ke=i("vxe-table"),ve=i("el-popconfirm"),K=i("el-form-item"),be=i("el-form");return d(),k("div",null,[a(_,{gutter:20},{default:o(()=>[a(p,{span:4},{default:o(()=>t[3]||(t[3]=[y("变量标题")])),_:1}),a(p,{span:4},{default:o(()=>t[4]||(t[4]=[y("变量名")])),_:1}),a(p,{span:10},{default:o(()=>t[5]||(t[5]=[y("变量值")])),_:1}),a(p,{span:2,offset:1},{default:o(()=>t[6]||(t[6]=[y("是否前端配置")])),_:1}),a(p,{span:3},{default:o(()=>t[7]||(t[7]=[y("操作")])),_:1})]),_:1}),a(be,{ref_key:"formRef",ref:J,model:s(r),"label-width":"0px","label-position":"left",style:{"margin-top":"20px"}},{default:o(()=>[(d(!0),k(j,null,N(s(g),(e,m)=>(d(),c(K,{prop:["array"].indexOf(e.form_item_type_label)>-1?"":e.key,key:m,rules:e.rule||[]},{default:o(()=>[a(p,{span:4},{default:o(()=>[e.edit?(d(),c(u,{key:0,modelValue:e.title,"onUpdate:modelValue":l=>e.title=l,style:{display:"inline-block",width:"200px"},placeholder:"请输入标题"},null,8,["modelValue","onUpdate:modelValue"])):(d(),k("span",Ne,C(e.title),1))]),_:2},1024),a(p,{span:4},{default:o(()=>[e.edit?(d(),c(u,{key:0,modelValue:e.new_key,"onUpdate:modelValue":l=>e.new_key=l,style:{width:"200px"},placeholder:"请输入变量key"},{default:o(()=>[v("template",Le,[v("span",We,C(L.editableTabsItem.key),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])):(d(),k("span",De,C(L.editableTabsItem.key)+"."+C(e.key),1))]),_:2},1024),a(p,{span:10},{default:o(()=>[["text","textarea"].indexOf(e.form_item_type_label)>-1?(d(),c(u,{key:m,type:e.form_item_type_label,modelValue:s(r)[e.key],"onUpdate:modelValue":l=>s(r)[e.key]=l,placeholder:e.placeholder,clearable:""},null,8,["type","modelValue","onUpdate:modelValue","placeholder"])):e.form_item_type_label==="number"?(d(),c(V,{key:m+1,modelValue:s(r)[e.key],"onUpdate:modelValue":l=>s(r)[e.key]=l,min:0},null,8,["modelValue","onUpdate:modelValue"])):["datetime","date","time"].indexOf(e.form_item_type_label)>-1?(d(),c(O,{modelValue:s(r)[e.key],"onUpdate:modelValue":l=>s(r)[e.key]=l,key:m+2,type:e.form_item_type_label,placeholder:e.placeholder},null,8,["modelValue","onUpdate:modelValue","type","placeholder"])):e.form_item_type_label==="select"?(d(),c(S,{key:m+3,modelValue:s(r)[e.key],"onUpdate:modelValue":l=>s(r)[e.key]=l,placeholder:e.placeholder,clearable:""},{default:o(()=>[(d(!0),k(j,null,N(s(q)(e.setting)||[],l=>(d(),c(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):e.form_item_type_label==="checkbox"?(d(),c($,{key:m+4,modelValue:s(r)[e.key],"onUpdate:modelValue":l=>s(r)[e.key]=l,placeholder:e.placeholder},{default:o(()=>[(d(!0),k(j,null,N(s(q)(e.setting)||[],l=>(d(),c(I,{key:l.value,label:l.value,value:l.value},{default:o(()=>[y(C(l.label),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):e.form_item_type_label==="radio"?(d(),c(ce,{key:m+5,modelValue:s(r)[e.key],"onUpdate:modelValue":l=>s(r)[e.key]=l,placeholder:e.placeholder,clearable:""},{default:o(()=>[(d(!0),k(j,null,N(s(q)(e.setting)||[],l=>(d(),c(fe,{key:l.value,label:l.value,value:l.value},{default:o(()=>[y(C(l.label),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):e.form_item_type_label==="switch"?(d(),c(X,{key:m+6,modelValue:s(r)[e.key],"onUpdate:modelValue":l=>s(r)[e.key]=l,"inactive-value":!1,"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue","onUpdate:modelValue"])):["img","imgs"].indexOf(e.form_item_type_label)>-1?(d(),k("div",{key:m+7},[a(Y,{action:s(A),headers:s(F),name:"file",accept:"image/*","on-preview":G,"on-success":(l,f,x)=>{H(l,f,x,e.key)},"on-error":M,"on-exceed":P,"before-remove":(l,f)=>{Q(l,f,e.key)},multiple:e.form_item_type_label!=="img",limit:e.form_item_type_label==="img"?1:5,ref_for:!0,ref:"imgUpload_"+e.key,"data-keyname":e.key,"file-list":e.value?e.value:[],"list-type":"picture-card"},{default:o(()=>t[8]||(t[8]=[v("i",{class:"el-icon-plus"},null,-1),v("div",{slot:"tip",class:"el-upload__tip"},"请选取图片,并且只能上传jpg/png文件",-1)])),_:2},1032,["action","headers","on-success","before-remove","multiple","limit","data-keyname","file-list"]),a(Z,{visible:s(D)},{default:o(()=>[v("img",{width:"100%",src:s(W),alt:""},null,8,$e)]),_:1},8,["visible"])])):["file"].indexOf(e.form_item_type_label)>-1?(d(),k("div",{key:m+8},[a(Y,{action:s(A),headers:s(F),name:"file","on-preview":G,"on-success":(l,f,x)=>{H(l,f,x,e.key)},"on-error":M,"on-exceed":P,"before-remove":(l,f)=>{Q(l,f,e.key)},limit:5,ref_for:!0,ref:"fileUpload_"+e.key,"data-keyname":e.key,"file-list":e.value,"list-type":"picture-card"},{default:o(()=>t[9]||(t[9]=[v("i",{class:"el-icon-plus"},null,-1),v("div",{slot:"tip",class:"el-upload__tip"},"请选取图片,并且只能上传jpg/png文件",-1)])),_:2},1032,["action","headers","on-success","before-remove","data-keyname","file-list"]),a(Z,{visible:s(D)},{default:o(()=>[v("img",{width:"100%",src:s(W),alt:""},null,8,Be)]),_:1},8,["visible"])])):["foreignkey","manytomany"].indexOf(e.form_item_type_label)>-1?(d(),k("div",{key:m+9},[a(me,{modelValue:s(r)[e.key],"onUpdate:modelValue":l=>s(r)[e.key]=l,"el-props":{pagination:!0,columns:e.setting.searchField},dict:{url:"/api/system/system_config/get_table_data/"+e.id+"/",value:e.setting.primarykey,label:e.setting.field},pagination:!0,multiple:e.form_item_type_label==="manytomany"},null,8,["modelValue","onUpdate:modelValue","el-props","dict","multiple"])])):e.form_item_type_label==="array"?(d(),k("div",{key:m+10},[a(ke,{border:"",resizable:"","auto-resize":"","show-overflow":"","keep-source":"",ref_for:!0,ref:"xTable_"+e.key,height:"200","edit-rules":ae,"edit-config":{trigger:"click",mode:"row",showStatus:!0}},{default:o(()=>[a(T,{field:"title",title:"标题","edit-render":{autofocus:".vxe-input--inner"}},{edit:o(({row:l})=>[a(B,{modelValue:l.title,"onUpdate:modelValue":f=>l.title=f,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(T,{field:"key",title:"键名","edit-render":{autofocus:".vxe-input--inner"}},{edit:o(({row:l})=>[a(B,{modelValue:l.key,"onUpdate:modelValue":f=>l.key=f,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(T,{field:"value",title:"键值","edit-render":{}},{edit:o(({row:l})=>[a(B,{modelValue:l.value,"onUpdate:modelValue":f=>l.value=f,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(T,{title:"操作",width:"100","show-overflow":""},{default:o(({row:l,index:f})=>[a(ye,{placement:"top",width:"160",modelValue:s(U),"onUpdate:modelValue":t[1]||(t[1]=x=>oe(U)?U.value=x:U=x)},{default:o(()=>[t[13]||(t[13]=v("p",null,"删除后无法恢复,确定删除吗？",-1)),v("div",qe,[a(h,{size:"mini",type:"text",onClick:t[0]||(t[0]=x=>oe(U)?U.value=!1:U=!1)},{default:o(()=>t[10]||(t[10]=[y("取消")])),_:1}),a(h,{type:"primary",size:"mini",onClick:x=>de(l,f,e.key)},{default:o(()=>t[11]||(t[11]=[y("确定")])),_:2},1032,["onClick"])]),a(h,{type:"text",slot:"reference"},{default:o(()=>t[12]||(t[12]=[y("删除")])),_:1})]),_:2},1032,["modelValue"])]),_:2},1024)]),_:2},1032,["edit-rules"]),v("div",null,[a(h,{size:"mini",onClick:l=>re("xTable_"+e.key)},{default:o(()=>t[14]||(t[14]=[y("追加")])),_:2},1032,["onClick"])])])):Ie("",!0)]),_:2},1024),a(p,{span:2,offset:1},{default:o(()=>[a(X,{modelValue:e.status,"onUpdate:modelValue":l=>e.status=l,"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(p,{span:3},{default:o(()=>[e.edit?(d(),c(h,{key:0,size:"mini",type:"primary",icon:s(Ue),onClick:l=>_e(e)},{default:o(()=>t[15]||(t[15]=[y("保存")])),_:2},1032,["icon","onClick"])):(d(),c(h,{key:1,size:"mini",type:"primary",icon:s(we),onClick:l=>pe(m)},null,8,["icon","onClick"])),a(ve,{title:"确定删除该条数据吗？",onConfirm:l=>ie(e)},{reference:o(()=>[a(h,{size:"mini",type:"danger",icon:s(Ce)},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1032,["prop","rules"]))),128)),a(K,null,{default:o(()=>[a(h,{type:"primary",onClick:t[2]||(t[2]=e=>se(J.value))},{default:o(()=>t[16]||(t[16]=[y("确定")])),_:1})]),_:1})]),_:1},8,["model"])])}}});const Me=je(Ee,[["__scopeId","data-v-d65a9267"]]);export{Me as default};
