import q from"./index.acca7465.js";import{g as E,a as P,d as R}from"./api.1e82473c.js";import{p as w,w as x,q as $}from"./index.ab2bd5b7.js";import{a as A,a0 as I,r as k,al as m,at as H,o as C,c as M,b,X as s,R as u,V as _,S as O,u as l,Q as D,U as Q,H as X}from"./vue.562ccee8.js";import{_ as G}from"./_plugin-vue_export-helper.c27b6911.js";const J={class:"columns-table-com"},K={class:"ctc-head"},L={class:"ctc-pagination"},W=A({__name:"index",props:{currentInfo:{type:Object,required:!0,default:()=>{}}},setup(V,{expose:z}){const r=V;let i=I({page:1,limit:20}),c=I({loading:!1,data:[],total:0}),d=k(!1),g=k({});const p=async(t=r.currentInfo)=>{try{c.loading=!0;const e=await E({...i,...t});(e==null?void 0:e.code)===2e3&&(c.data=e.data,c.total=e.total)}finally{c.loading=!1}},B=async()=>{var t,e,a;if((t=r.currentInfo)!=null&&t.role&&((e=r.currentInfo)!=null&&e.model)&&((a=r.currentInfo)!=null&&a.app)){const o=await P(r.currentInfo);(o==null?void 0:o.code)===2e3&&(w("匹配成功"),p());return}x("请选择角色和模型表！")},v=(t,e)=>{var a,o,f;if((a=r.currentInfo)!=null&&a.role&&((o=r.currentInfo)!=null&&o.model)&&((f=r.currentInfo)!=null&&f.app)){t==="update"&&e&&(g.value=e),d.value=!0;return}x("请选择角色和模型表！")},y=t=>{t==="submit"&&p(),d.value=!1,g.value={}},h=({id:t})=>{$.confirm("确定删除该字段吗？","提示",{type:"error",confirmButtonText:"确定",cancelButtonText:"取消"}).then(async()=>{const e=await R(t);(e==null?void 0:e.code)===2e3&&(w("删除成功"),p())}).catch(()=>{})},N=t=>{i.limit=t,p()},U=t=>{i.page=t,p()};return z({fetchData:p}),(t,e)=>{const a=m("el-button"),o=m("el-table-column"),f=m("el-table"),F=m("el-pagination"),S=m("el-drawer"),T=H("loading");return C(),M("div",J,[e[8]||(e[8]=b("p",{class:"ctc-title"},"字段权限",-1)),b("div",K,[s(a,{type:"primary",onClick:e[0]||(e[0]=n=>v("create"))},{default:u(()=>e[4]||(e[4]=[_("新增")])),_:1}),s(a,{type:"primary",onClick:B},{default:u(()=>e[5]||(e[5]=[_("自动匹配")])),_:1})]),O((C(),D(f,{data:l(c).data,border:"",class:"ctc-table"},{default:u(()=>[s(o,{prop:"field_name",label:"字段名"}),s(o,{prop:"title",label:"列名"}),s(o,{label:"操作",width:"180",align:"center"},{default:u(n=>[s(a,{type:"primary",onClick:j=>v("update",n.row)},{default:u(()=>e[6]||(e[6]=[_("编辑")])),_:2},1032,["onClick"]),s(a,{type:"danger",onClick:j=>h(n.row)},{default:u(()=>e[7]||(e[7]=[_("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[T,l(c).loading]]),b("div",L,[s(F,{"current-page":l(i).page,"onUpdate:currentPage":e[1]||(e[1]=n=>l(i).page=n),"page-size":l(i).limit,"onUpdate:pageSize":e[2]||(e[2]=n=>l(i).limit=n),"page-sizes":[5,10,20,50],total:l(c).total,background:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:N,onCurrentChange:U},null,8,["current-page","page-size","total"])]),s(S,{modelValue:l(d),"onUpdate:modelValue":e[3]||(e[3]=n=>X(d)?d.value=n:d=n),title:"字段权限",direction:"rtl",size:"500px","close-on-click-modal":!1,"before-close":y},{default:u(()=>[l(d)?(C(),D(q,{key:0,currentInfo:r.currentInfo,initFormData:l(g),onDrawerClose:y},null,8,["currentInfo","initFormData"])):Q("",!0)]),_:1},8,["modelValue"])])}}});const oe=G(W,[["__scopeId","data-v-9ec74dbf"]]);export{oe as default};
