import{a as W,r as i,a0 as Q,l as X,al as _,at as Y,o as U,c as j,S as A,Y as q,u as a,b as o,W as x,X as p,H as C,R as u,Q as K,V,O as $,F as ee}from"./vue.562ccee8.js";import{J as te,O as oe,w as y,p as se}from"./index.ab2bd5b7.js";import{M as N}from"./md5.b5efbca3.js";import{c as ae,g as ne,r as le}from"./crud.f15e3bf8.js";import{_ as re}from"./index.vue_vue_type_script_setup_true_name_importExcel_lang.c6a669b0.js";import{i as F,L as ie}from"./echarts.041eecf8.js";import{_ as de}from"./_plugin-vue_export-helper.c27b6911.js";import"./dictionary.100483c1.js";import"./authFunction.ff362cdf.js";const pe={class:"dept-user-com-box dept-info"},ue={class:"di-left"},ce={class:"di-cell"},me={class:"content"},fe={class:"di-cell"},we={class:"content"},_e={class:"di-cell"},ve={class:"content"},ge={class:"di-cell"},he={class:"dialog-footer"},xe=W({name:"user"}),ye=W({...xe,setup(Pe,{expose:E}){let S,k;const D=i(),R=i(),{crudExpose:v}=te({crudRef:D,crudBinding:R});let g=i(""),B=i(),O=i(),c=i(!1),n=i({}),d=i(!1),m=i(!1),t=Q({id:0,newPassword:"",newPassword2:""});const H=()=>{var r,h;const s=((r=n.value.sub_dept_map)==null?void 0:r.map(w=>w.name))||[],e=((h=n.value.sub_dept_map)==null?void 0:h.map(w=>w.count))||[],f={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:s,axisTick:{alignWithLabel:!0}},yAxis:{type:"value"},dataZoom:[{type:"inside"}],grid:{top:"6%",right:"5%",bottom:"10%",left:"10%"},series:[{data:e,type:"bar",barWidth:"60%",showBackground:!0,itemStyle:{color:new ie(0,0,0,1,[{offset:0,color:"#83bff6"},{offset:.5,color:"#188df0"},{offset:1,color:"#188df0"}])}}]};S.setOption(f)},L=()=>{var e,f,r;const s={tooltip:{trigger:"item"},legend:{orient:"vertical",right:"0%",left:"65%",top:"center",itemWidth:12,itemHeight:12},series:[{type:"pie",radius:"65%",center:["32%","50%"],label:{show:!1,position:"center"},color:["#188df0","#f56c6c","#dcdfe6"],data:[{value:((e=n.value.gender)==null?void 0:e.male)||0,name:"男"},{value:((f=n.value.gender)==null?void 0:f.female)||0,name:"女"},{value:((r=n.value.gender)==null?void 0:r.unknown)||0,name:"未知"}]}]};k.setOption(s)},P=async()=>{const s=await ne(g.value,c.value?"1":"0");(s==null?void 0:s.code)===2e3&&(n.value=s.data,H(),L())},I=s=>{g.value=s,v.doSearch({form:{dept:s}}),P()},M=()=>{I(g.value)},T=({id:s})=>{t.id=s,m.value=!0},b=()=>{m.value=!1,t.id=0,t.newPassword="",t.newPassword2=""},Z=async()=>{if(!t.id){y("请选择用户！");return}if(!t.newPassword||!t.newPassword2){y("请输入密码！");return}if(t.newPassword!==t.newPassword2){y("两次输入密码不一致");return}const s=new RegExp("(?=.*[0-9])(?=.*[a-zA-Z]).{8,30}");if(!s.test(t.newPassword)||!s.test(t.newPassword2)){y("您的密码复杂度太低(密码中必须包含字母、数字)");return}const e=await le(t.id,{newPassword:N.hashStr(t.newPassword),newPassword2:N.hashStr(t.newPassword2)});(e==null?void 0:e.code)===2e3&&(se(e.msg||"修改成功！"),b())};X(()=>{S=F(B.value),k=F(O.value),P(),v.doRefresh()}),E({handleDoRefreshUser:I});const{crudOptions:z}=ae({crudExpose:v,context:{getDeptInfo:P,isShowChildFlag:c,handleResetPwdOpen:T}});return oe({crudExpose:v,crudOptions:z,context:{}}),(s,e)=>{const f=_("el-switch"),r=_("el-button"),h=_("fs-crud"),w=_("el-input"),G=_("el-dialog"),J=Y("auth");return U(),j(ee,null,[A(o("div",pe,[o("div",ue,[o("h3",null,x(a(n).dept_name||""),1),o("div",ce,[e[5]||(e[5]=o("p",null,"部门负责人：",-1)),o("p",me,x(a(n).owner||"无"),1)]),o("div",fe,[e[6]||(e[6]=o("p",null,"部门人数：",-1)),o("p",we,x(a(n).dept_user||0)+"人",1)]),o("div",_e,[e[7]||(e[7]=o("p",null,"部门简介：",-1)),o("p",ve,x(a(n).description||"无"),1)]),o("div",ge,[e[8]||(e[8]=o("p",null,"显示子级：",-1)),p(f,{modelValue:a(c),"onUpdate:modelValue":e[0]||(e[0]=l=>C(c)?c.value=l:c=l),"inline-prompt":"","active-text":"是","inactive-text":"否",disabled:!a(g),onChange:M,style:{"--el-switch-on-color":"var(--el-color-primary)"}},null,8,["modelValue","disabled"])])]),o("div",{style:{height:"180px",width:"380px"},ref_key:"deptCountBar",ref:B},null,512),o("div",{style:{height:"180px",width:"200px"},ref_key:"deptSexPie",ref:O},null,512)],512),[[q,!a(d)]]),p(h,$({ref_key:"crudRef",ref:D},R.value,{customClass:a(d)?"dept-user-com-box dept-user-com-table-cover":"dept-user-com-box dept-user-com-table"}),{"toolbar-left":u(()=>[p(r,{icon:a(d)?"View":"Hide",circle:"",onClick:e[1]||(e[1]=l=>C(d)?d.value=!a(d):d=!a(d))},null,8,["icon"])]),"actionbar-right":u(()=>[A((U(),K(re,{api:"api/system/user/"},{default:u(()=>e[9]||(e[9]=[V("导入 ")])),_:1})),[[J,"user:Import"]])]),_:1},16,["customClass"]),p(G,{modelValue:a(m),"onUpdate:modelValue":e[4]||(e[4]=l=>C(m)?m.value=l:m=l),title:"重设密码",width:"400px",draggable:"","before-close":b},{footer:u(()=>[o("span",he,[p(r,{onClick:b},{default:u(()=>e[10]||(e[10]=[V("取消")])),_:1}),p(r,{type:"primary",onClick:Z},{default:u(()=>e[11]||(e[11]=[V(" 保存 ")])),_:1})])]),default:u(()=>[o("div",null,[p(w,{modelValue:a(t).newPassword,"onUpdate:modelValue":e[2]||(e[2]=l=>a(t).newPassword=l),type:"password",placeholder:"请输入密码","show-password":"",style:{"margin-bottom":"20px"}},null,8,["modelValue"]),p(w,{modelValue:a(t).newPassword2,"onUpdate:modelValue":e[3]||(e[3]=l=>a(t).newPassword2=l),type:"password",placeholder:"请再次输入密码","show-password":""},null,8,["modelValue"])])]),_:1},8,["modelValue"])],64)}}});const Ie=de(ye,[["__scopeId","data-v-e76f8651"]]);export{Ie as default};
